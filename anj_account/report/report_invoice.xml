<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <data>
        <!-- <t t-esc="o.currency_id.amount_to_text(o.amount_total)" /> self.invoice_line_ids.product_id.tax_string-->
        <template id="report_invoice_inherit" inherit_id="account.report_invoice_document">
            <xpath expr="//t[@t-call='web.external_layout']" position="before">
                <head>
                    <link rel="stylesheet" href="/anj_account/static/src/css/report_accnt_jd.css"/>
                </head>
            </xpath>
            <xpath expr="//t[@t-call='web.external_layout']/t[1]" position="before">
                <t t-set="no_header" t-if="o.journal_id.no_header or o.company_id.name.lower() == 'jara trade'">False</t>
            </xpath>
            <xpath expr="//t[@t-call='web.external_layout']/t[1]" position="before">
                <t t-set="no_header" t-if="o.company_id.name.lower() == 'jara trade'">False</t>
            </xpath>
            <xpath expr="//div[hasclass('page')]/h2//span[last()]" position="before">
                <span t-if="not o.company_id.name.lower() == 'societe immobiliere anjary'"> N° </span>
            </xpath>
            <xpath expr="//div[hasclass('page')]/h2" position="attributes">
                <attribute name="style">font-size: 16px; margin-top: 10px; border: 3px solid black; padding: 3px; width: 60%</attribute>
            </xpath>
            <xpath expr="//div[@id='informations']" position="replace">
                <t t-if="not((not o.company_id.name.lower().startswith('jara dist')) or (not o.company_id.name.lower() == 'societe immobiliere anjary'))">
                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_date" name="invoice_date">
                        Date de la facturation: <span t-field="o.invoice_date" t-options="{'widget': 'date'}"/>
                    </div>
                    <div class="col-auto col-3 mw-100 mb-2" t-if="o.ref" name="reference">
                        <span t-field="o.ref"/>
                    </div>
                    
                </t>
                <t t-else="">
                    <t t-if="o.company_id.name.lower() == 'societe immobiliere anjary'">
                        <div id="informations" class="row mt-4 mb-4">
                        <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_date" name="invoice_date">
                            <t t-if="o.move_type == 'out_invoice'"><strong>Invoice Date:</strong></t>
                            <t t-elif="o.move_type == 'out_refund'"><strong>Credit Note Date:</strong></t>
                            <t t-elif="o.move_type == 'out_receipt'"><strong>Receipt Date:</strong></t>
                            <t t-else=""><strong>Date:</strong></t>
                            <p class="m-0" t-field="o.invoice_date"/>
                        </div>
                        <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_date_due and o.move_type == 'out_invoice' and o.state == 'posted'" name="due_date">
                            <strong>Due Date:</strong>
                            <p class="m-0" t-field="o.invoice_date_due"/>
                        </div>
                    </div>
                    </t>
                    <t t-else="">
                        <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_date" name="invoice_date">
                            <t t-if="o.move_type == 'out_invoice'">
                                <strong>Date de facturation:</strong>
                            </t>
                            <t t-elif="o.move_type == 'out_refund'">
                                <strong>Date de la note de crédit:</strong>
                            </t>
                            <t t-elif="o.move_type == 'out_receipt'">
                                <strong>Date de réception:</strong>
                            </t>
                            <t t-else="">
                                <strong>Date:</strong>
                            </t>
                            <p class="m-0" t-field="o.invoice_date"/>
                        </div>
                        <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_date_due and o.move_type == 'out_invoice' and o.state == 'posted'" name="due_date">
                            <strong>Date d'échéance:</strong>
                            <p class="m-0" t-field="o.invoice_date_due"/>
                        </div>
                            <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_origin" name="origin">
                                <!--<strong>Source:</strong>-->
                                <p class="m-0" t-field="o.invoice_origin"/>
                            </div>
                            <div class="col-auto col-3 mw-100 mb-2" t-if="o.partner_id.ref" name="customer_code">
                                <strong>Code client:</strong>
                                <p class="m-0" t-field="o.partner_id.ref"/>
                            </div>
                            <div class="col-auto col-3 mw-100 mb-2" t-if="o.ref" name="reference">
                                <strong>Référence:</strong>
                                <p class="m-0" t-field="o.ref"/>
                            </div>
                        </t>
                </t>
            </xpath>
            <xpath expr="//div[hasclass('page')]/h2//span[last()]" position="after">
                <span t-if="o.partner_sequence"> -                    <span t-field="o.partner_sequence"/>
                </span>
            </xpath>
            <xpath expr="//div[hasclass('page')]//table[@name='invoice_line_table']//th[@name='th_taxes']" position="before">
                <t t-if="o.company_id.name == 'JARA DISTRIBUTION'">
                    <th name="th_pu_remise" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else pass }}">
                        <span>Pu Remisé</span>
                    </th>
                </t>
            </xpath>
            <xpath expr="//t[@t-set='address']" position="replace">
                <t t-set="address">
                    <t t-if="o.company_id.name.lower() == 'societe immobiliere anjary'">
                            <br/>
                        </t>
                    <div t-att-style="'margin-top: 150px;' if o.company_id.name.lower() == 'societe immobiliere anjary' else ''">
                    <div t-att-style="' border: 3px solid black; border-radius: 10px; padding: 5px' if not o.company_id.name.lower().startswith('jara dis') else ''">
                        <address t-field="o.partner_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}' />
                        <div t-if="o.partner_id.vat" class="mt16">
                            <t t-if="o.company_id.account_fiscal_country_id.vat_label" t-esc="o.company_id.account_fiscal_country_id.vat_label" id="inv_tax_id_label"/>
                            <t t-else="">Tax ID</t>:                            <span t-field="o.partner_id.vat"/>
                        </div>
                        <div t-if="o.partner_id.company_type == 'company'">
                            <div t-if="o.partner_id.company_type == 'company' and o.partner_id.nif">
                            NIF:<span t-esc="o.partner_id.nif" />
                            </div>
                            <div t-if="o.partner_id.company_type == 'company' and o.partner_id.stat">
                            STAT: <span t-esc="o.partner_id.stat"/>
                            </div>
                            <div t-if="o.partner_id.company_type == 'company' and o.partner_id.cif">
                            CIF: <span t-esc="o.partner_id.cif"/>
                            </div>
                            <div t-if="o.partner_id.company_type == 'company' and o.partner_id.rcs">
                            RCS: <span t-esc="o.partner_id.rcs"/>
                            </div>
                        </div>
                    </div>
                    </div>
                </t>
            </xpath>
            <xpath expr="//p[@name='payment_communication']" position="replace">
                <p t-if="o.move_type in ('out_invoice', 'in_refund') and o.payment_reference" name="payment_communication">
                    <span></span>
                </p>
            </xpath>
            <xpath expr="//p[@name='payment_communication']" position="before">
                <t t-if="o.company_id.name == 'JARA DISTRIBUTION'">
                    <br/>
                    <div style="margin-top:10px;margin-bottm:10px" t-attf-class="#{'col-sm-7 col-md-6' if report_type == 'html' else pass} ml-auto">
                        <span>Arrêtée la présente facture au montant de :</span>
                        <span t-esc="o.currency_id.amount_to_text(o.amount_total)" />
                    </div>
                    <br/>
                </t>
                <t t-if="o.company_id.name == 'JARATRADE'">
                    <br/>
                    <div style="margin-top:10px;margin-bottm:10px" t-attf-class="#{'col-sm-7 col-md-6' if report_type == 'html' else pass} ml-auto">
                        <span>Arrêtée la présente facture au montant de :</span>
                        <span t-esc="o.currency_id.amount_to_text(o.amount_total)" />
                    </div>
                    <br/>
                </t>
            </xpath>
            <xpath expr="//div[hasclass('page')]" position="inside">
                <t t-if="o.company_id.name == 'JARA DISTRIBUTION'">
                    <div id="signature" class="row mt32 mb32" style="text-align:center">
                        <div class="col-auto col-3 mw-100 mb-2" name="responsable">
                            <span>Le Responsable</span>
                        </div>
                        <div class="col-auto col-3 mw-100 mb-2" name="chauffeur">
                            <span>Le Chauffeur</span>
                        </div>
                        <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_origin" name="client">
                            <span>Le Client</span>
                        </div>
                    </div>
                </t>
                <t t-if="o.company_id.name == 'JARATRADE'">
                    <div id="signature" class="row mt32 mb32" style="text-align:center">
                        <div class="col-auto col-3 mw-100 mb-2" name="responsable">
                            <span>Le Responsable</span>
                        </div>
                        <div class="col-auto col-3 mw-100 mb-2" name="chauffeur">
                            <span>Le Chauffeur</span>
                        </div>
                        <div class="col-auto col-3 mw-100 mb-2" t-if="o.invoice_origin" name="client">
                            <span>Le Client</span>
                        </div>
                    </div>
                </t>

            </xpath>
            <xpath expr="//div[hasclass('page')]" position="before">
                <t t-if="o.company_id.name != 'SOCIETE IMMOBILIERE ANJARY'">
                <div style="width:100%;">
                    <div t-if="o.company_id.partner_id.nif">
                        NIF:<span t-esc="o.company_id.partner_id.nif" />
                    </div>
                    <div t-if="(o.company_id.partner_id.company_type == 'company') and o.company_id.partner_id.stat">
                        STAT: <span t-esc="o.company_id.partner_id.stat"/>
                    </div>
                    <div t-if="(o.company_id.partner_id.company_type == 'company') and o.company_id.partner_id.cif">CIF: <span t-esc="o.company_id.partner_id.cif"/>
                    </div>
                </div>
                </t>
            </xpath>
            <xpath expr="//th[@name='th_taxes']" position="attributes">
                <attribute name="t-if">o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary'</attribute>
            </xpath>
            <xpath expr="//th[@name='th_priceunit']" position="replace">
                <th style="border: 1px solid black;" name="th_priceunit" t-if="o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary'" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"><span>Unit Price</span></th>
                <th style="border: 1px solid black;" t-else="" name="th_priceunit" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"><span>P.U HT</span></th>
            </xpath>
            <xpath expr="//th[@name='th_price_unit']" position="after">
                <th style="border: 1px solid black;" name="th_pu_net" t-if="not (o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary')" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"><span>P.U NET</span></th>
            </xpath>
<!--            HT HT -->

            <xpath expr="//span[@t-field='line.price_unit']" position="replace">
<!--                <span class="text-nowrap" t-field="line.product_id.tax_string"/>-->
                <span class="text-nowrap" t-field="line.product_id.price_unit_ht"/>
            </xpath>
            <!--            HT HT -->
            <xpath expr="//th[@name='th_quantity']" position="replace">
                <th style="border: 1px solid black;" name="th_quantity" class="text-right" t-if="o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary'"><span>Quantity</span></th>
                <th style="border: 1px solid black;" name="th_quantity" class="text-right" t-else=""><span>Qté</span></th>
            </xpath>
            <xpath expr="//th[@name='th_description']" position="before">
                <th style="border: 1px solid black;" name="th_product_ref" class="text-left" t-if="not (o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary')">Ref</th>
            </xpath>
            <xpath expr="//th[@name='th_price_unit']" position="attributes">
                <attribute name="t-att-style"
                           add="('border: 1px solid black;')"/>
            </xpath>
            <xpath expr="//td[@name='account_invoice_line_name']" position="attributes">
                <attribute name="t-att-style"
                           add="('border: 1px solid black;')"/>
            </xpath>
            <xpath expr="//t[@name='account_invoice_line_accountable']/td[2]" position="attributes">
                <attribute name="t-att-style"
                           add="('border: 1px solid black;')"/>
            </xpath>
            <xpath expr="//t[@name='account_invoice_line_accountable']/td[3]" position="attributes">
                <attribute name="t-att-style"
                           add="('border: 1px solid black;')"/>
            </xpath>
            <xpath expr="//t[@name='account_invoice_line_accountable']/td[4]" position="attributes">
                <attribute name="t-att-style"
                           add="('border: 1px solid black;')"/>
            </xpath>
            <xpath expr="//td[@name='account_invoice_line_name']" position="before">
                <td style="border: 1px solid black;" t-if="not (o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary')" name="account_invoice_line_ref"><span t-field="line.product_id.default_code"/></td>
            </xpath>
            <xpath expr="//th[@name='th_description']" position="replace">
                <th style="border: 1px solid black;" name="th_description" class="text-left"><span t-if="not (o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary')">Désignation</span><span t-else="">Description</span></th>
            </xpath>
            <xpath expr="//th[@name='th_subtotal']" position="replace">
                <th style="border: 1px solid black;" name="th_subtotal" class="text-right" t-if="o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary'">
                    <span groups="account.group_show_line_subtotals_tax_excluded">Amount</span>
                    <span groups="account.group_show_line_subtotals_tax_included">Total Price</span>
                </th>
                <th style="border: 1px solid black;" name="th_subtotal" class="text-right" t-else="">
                    <span>Montant HT</span>
                </th>
            </xpath>
            <xpath expr="//t[@name='account_invoice_line_accountable']/td[5]" position="after">
<!--                <td style="text-align: right;border: 1px solid;" t-if="not (o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary')"><t t-esc="line.price_unit - line.price_unit * line.discount * 0.01"/></td>-->
                <td style="text-align: right;border: 1px solid;"><t t-esc="line.product_id.price_unit_ht"/></td>
            </xpath>


            <xpath expr="//t[@name='account_invoice_line_accountable']/td[7]" position="attributes">
                <attribute name="t-if">o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary'</attribute>
            </xpath>

            <xpath expr="//t[@name='account_invoice_line_accountable']/td[hasclass('o_price_total')]" position="replace">
                <td style="border: 1px solid black;" class="text-right o_price_total" t-if="o.company_id.name.startswith('jara dist') or o.company_id.name.lower() == 'societe immobiliere anjary'">
                    <span class="text-nowrap" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                    <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                </td>
                <td style="border: 1px solid black;" class="text-right o_price_total" t-else="">
                    <span class="text-nowrap" t-field="line.price_subtotal"/>
                </td>
            </xpath>
            <xpath expr="//div[@id='total']" position="replace">
                <div t-if="o.company_id.name.lower() == 'societe immobiliere anjary'" id="total" class="row">
                    <div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">
                        <table class="table table-sm" style="page-break-inside: avoid;">

                            <!--Tax totals-->
                            <t t-set="tax_totals" t-value="json.loads(o.tax_totals_json)"/>
                            <t t-call="account.document_tax_totals"/>

                            <!--Payments-->
                            <t t-if="print_with_payments">
                                <t t-if="o.payment_state != 'invoicing_legacy'">
                                    <t t-set="payments_vals" t-value="o.sudo()._get_reconciled_info_JSON_values()"/>
                                    <t t-foreach="payments_vals" t-as="payment_vals">
                                        <tr>
                                            <td style="border: 1px solid black;">
                                                <i class="oe_form_field text-right oe_payment_label">Paid on <t t-esc="payment_vals['date']" t-options='{"widget": "date"}'/></i>
                                            </td>
                                            <td style="border: 1px solid black;" class="text-right">
                                                <span t-esc="payment_vals['amount']" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </td>
                                        </tr>
                                    </t>
                                    <t t-if="len(payments_vals) > 0">
                                        <tr class="border-black">
                                            <td style="border: 1px solid black;"><strong>Amount Due</strong></td>
                                            <td style="border: 1px solid black;" class="text-right">
                                                <span t-field="o.amount_residual"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                            </t>
                        </table>
                    </div>
                </div>

                <div t-else="" id="total" class="row">
                    <div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">
                        <table class="table table-sm" style="page-break-inside: avoid;">

                            <!--Tax totals-->
                            <t t-set="tax_totals" t-value="json.loads(o.tax_totals_json)"/>
                            <t t-call="account.document_tax_totals" t-if="o.company_id.name.startswith('jara dist')"/>
                            <t t-else="">
                                <table class="table table-sm" style="border: 1px solid black;">
                                    <tr>
                                        <td style="border: 1px solid black;">Total HT</td>
                                        <td style="border: 1px solid black;background-color: none; text-align: right">
                                            <t t-esc="o.amount_untaxed" t-options="{'widget': 'float', 'precision': 2}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid black;">Total TVA</td>
                                        <td style="background-color: none; text-align: right; border: 1px solid black;">
                                            <t t-esc="o.amount_total - o.amount_untaxed" t-options="{'widget': 'float', 'precision': 2}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid black;">Total TTC</td>
                                        <td style="background-color: none;  border: 1px solid black;text-align: right">
                                            <t t-esc="o.amount_total" t-options="{'widget': 'float', 'precision': 2}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid black;">Net à payer Ar</td>
                                        <td style="border: 1px solid black;background-color: none; text-align: right">
                                            <t t-esc="o.amount_total" t-options="{'widget': 'float', 'precision': 2}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid black;">Net à payer Fmg</td>
                                        <td style="border: 1px solid black;background-color: none; text-align: right">
                                            <t t-esc="o.amount_total * 5" t-options="{'widget': 'float', 'precision': 2}"/>
                                        </td>
                                    </tr>
                                </table>
                            </t>

                            <!--Payments-->
                            <t t-if="print_with_payments">
                                <t t-if="o.payment_state != 'invoicing_legacy'">
                                    <t t-set="payments_vals" t-value="o.sudo()._get_reconciled_info_JSON_values()"/>
                                    <t t-foreach="payments_vals" t-as="payment_vals">
                                        <tr>
                                            <td>
                                                <i class="oe_form_field text-right oe_payment_label">Paid on <t t-esc="payment_vals['date']" t-options='{"widget": "date"}'/></i>
                                            </td>
                                            <td class="text-right">
                                                <span t-esc="payment_vals['amount']" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                            </td>
                                        </tr>
                                    </t>
                                    <t t-if="len(payments_vals) > 0">
                                        <tr class="border-black">
                                            <td><strong>Amount Due</strong></td>
                                            <td class="text-right">
                                                <span t-field="o.amount_residual"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                            </t>
                        </table>
                    </div>
                </div>
            </xpath>

            <xpath expr="//p[@name='payment_communication']" position="before">
                <br/>
            </xpath>

            <xpath expr="//p[@name='incoterm']" position="after">
                <t t-if="o.company_id.name.lower() == 'societe immobiliere anjary'">
                    <br/>
                    <t t-if="print_with_payments">
                        <t t-foreach='o.quit_payment_ids' t-as='payment'>
                            <p>
                                <strong>Paid on : </strong><span t-field="payment.date"/> (<span t-field="payment.ref"/>)
                            </p>
                        </t>
                    </t>
                </t>
            </xpath>

        </template>

        <template id="external_layout_standard_inherit" inherit_id="web.external_layout_boxed">
            <xpath expr="//div[@t-att-style='report_header_style']" position="attributes">
                <attribute name="t-if">not no_header</attribute>
            </xpath>
            <xpath expr="//t[@t-call='web.address_layout']" position="replace">
                <t t-call="web.address_layout" t-if="not no_header"/>
            </xpath>
<!--            <xpath expr="//div[@name='company_address']" position="replace">-->
<!--                <t t-if="not company.name.lower() == 'societe immobiliere anjary'">-->
<!--                    <div name="company_address" class="float-right mb4">-->
<!--                        <span t-if="company.company_details" t-field="company.company_details"></span>-->
<!--                    </div>-->
<!--                </t>-->
<!--            </xpath>-->
            <xpath expr="//div[@class='row mb8']" position="after">

                <div name="company_address" class="">
                    <t t-if="company.name.lower() == 'societe immobiliere anjary'">
                        <span t-if="company.company_details" style="font-size:5px!important;" t-field="company.company_details"></span>
                    </t>
                </div>
            </xpath>
        </template>

    </data>

</odoo>